FROM node:20

WORKDIR /app

# Copy package files and TypeScript config
COPY package.json ./package.json
COPY tsconfig.json ./tsconfig.json
COPY tsconfig.server.json ./tsconfig.server.json

# Install all dependencies
RUN npm install

# Copy source code
COPY api ./api

# Compile TypeScript to JavaScript using server config
RUN npx tsc -p tsconfig.server.json

EXPOSE 5500

# Run compiled JavaScript
CMD ["node", "dist/api/server.js"]